<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏û‡∏∑‡∏ä</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 10px;
      overflow: hidden;
    }

    .controls {
      margin-bottom: 10px;
    }

    button {
      padding: 6px 12px;
      font-size: 14px;
    }

    .wrapper {
      width: 100%;
      max-height: 90vh;
      overflow: auto;
      border: 1px solid #ccc;
    }

    table {
      border-collapse: collapse;
      width: max-content; /* ‡πÉ‡∏´‡πâ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ */
      min-width: 100%;
    }

    th,
    td {
      width: 24px;
      height: 24px;
      text-align: center;
      vertical-align: middle;
      font-size: 10px;
      padding: 0;
      border: 1px solid #eee;
      user-select: none;
    }

    th.fixed-header {
      position: sticky;
      top: 0;
      background-color: #f8f8f8;
      z-index: 10;
    }

    td.fixed-column,
    th.fixed-column {
      position: sticky;
      left: 0;
      background-color: #f8f8f8;
      font-weight: bold;
      width: 60px;
      z-index: 11;
      text-align: right;
      padding-right: 6px;
    }

    td.cell {
      cursor: pointer;
      background-color: #ccc;
      transition: background-color 0.2s;
    }

    td.cell.green {
      background-color: green !important;
    }
  </style>
</head>
<body>
  <div class="controls">
    <button onclick="exportToExcel()">üì§ Excel</button>
  </div>

  <div class="wrapper">
    <table id="plant-table" aria-label="‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏û‡∏∑‡∏ä">
      <thead>
        <tr>
          <th class="fixed-header fixed-column">‡πÅ‡∏ñ‡∏ß/‡∏´‡∏•‡∏∏‡∏°</th>
          <!-- ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡∏•‡∏∏‡∏° -->
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const rows = 106;
    const cols = 200;
    const table = document.getElementById("plant-table");
    const theadRow = table.querySelector("thead tr");
    const tbody = table.querySelector("tbody");

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà (0=‡πÄ‡∏ó‡∏≤,1=‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß)
    let data =
      JSON.parse(localStorage.getItem("plantData")) || Array(rows * cols).fill(0);

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏•‡∏Ç‡∏´‡∏•‡∏∏‡∏° (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏∏‡∏Å 5 ‡∏´‡∏•‡∏∏‡∏°)
    for (let c = 0; c < cols; c++) {
      const th = document.createElement("th");
      if ((c + 1) % 5 === 0) {
        th.textContent = c + 1;
      }
      th.className = "fixed-header";
      theadRow.appendChild(th);
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    for (let r = 0; r < rows; r++) {
      const tr = document.createElement("tr");

      // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ñ‡∏ß
      const rowHeader = document.createElement("td");
      rowHeader.textContent = `‡πÅ‡∏ñ‡∏ß ${r + 1}`;
      rowHeader.className = "fixed-column";
      tr.appendChild(rowHeader);

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      for (let c = 0; c < cols; c++) {
        const index = r * cols + c;
        const td = document.createElement("td");
        td.className = "cell";
        if (data[index] === 1) td.classList.add("green");

        td.addEventListener("click", () => {
          // ‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ó‡∏≤ <-> ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
          data[index] = data[index] === 1 ? 0 : 1;
          td.classList.toggle("green");
          localStorage.setItem("plantData", JSON.stringify(data));
        });

        tr.appendChild(td);
      }

      tbody.appendChild(tr);
    }

    // Export Excel
    function exportToExcel() {
      const ws_data = [];
      const header = ["‡πÅ‡∏ñ‡∏ß/‡∏´‡∏•‡∏∏‡∏°"];
      for (let c = 0; c < cols; c++) {
        header.push(`L${c + 1}`);
      }
      ws_data.push(header);

      for (let r = 0; r < rows; r++) {
        const row = [`‡πÅ‡∏ñ‡∏ß ${r + 1}`];
        for (let c = 0; c < cols; c++) {
          const index = r * cols + c;
          row.push(data[index] === 1 ? "‡∏á‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß" : "0");
        }
        ws_data.push(row);
      }

      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      XLSX.utils.book_append_sheet(wb, ws, "‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏•‡∏π‡∏Å");
      XLSX.writeFile(wb, "plant-report.xlsx");
    }
  </script>
</body>
</html>
